{
  "hash": "7a06619fed5f432cdf00a0c9bb488e28",
  "result": {
    "markdown": "---\ntitle: \"Boosting to Predict Eel Distribution\"\nauthor:\n  - name: Elke Windschitl\n    url: https://elkewind.github.io\n    affiliation: UCSB Bren School\n    affiliation-url: http://ucsb-meds.github.io\ndescription: \"A species distribution model example with eel\"\ndate: 2022-12-02\ncategories: [MEDS, Machine Learning, R]\ncitation: \n  url: https://elkewind.github.io/posts/2023-03-23-eel-sdm\nimage: eel.jpg\nformat: \n  html:\n    code-fold: true\n    code-tools: true\ntoc: true\ndraft: false\n---\n\n\n## Description:\n\nIn this post, I attempt to reproduce work by [Elith et al. 2008](https://besjournals.onlinelibrary.wiley.com/doi/10.1111/j.1365-2656.2008.01390.x) \\[1\\] to model species distribution of short-finned eel (*Anguilla australis*) using Boosted Regression Trees. This analysis was created for an assignment for EDS 232 Machine Learning in Environmental Scinece -- a course in UCSB's Master's of Environmental Data Science curriculum taught by Mateo Robbins.\n\nBoosting is a popular machine learning algorithm that builds models sequentially based on information learned from the previous model. Here, decision trees will be built in sequence using extreme gradient boosting to classify presence or absence of short-finned eel in a given location associated with environmental parameters such as temperature, slope, rainy days, etc. Elith et al. used package gbm in R, whereas I use a Tidymodels approach in R.\n\n## Data\n\nData labeled \"model.data.csv\" were retrieved from the supplemental information by Elith et al. 2008 and include the following variables:\n\n![Figure 1: Table 1. from Elith et al. 2008 displaying the variables included in the analysis.](variables.png)\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load libraries\nlibrary(tidyverse)\nlibrary(tidymodels)\nlibrary(sjPlot)\nlibrary(pROC)\nlibrary(RColorBrewer)\n\neel_data <- eel_data_raw %>%\n  select(-Site) # remove site number from data frame\neel_data$Angaus <- as.factor(eel_data$Angaus) # set outcome vaiable as a factor\n\ntab_df(eel_data[1:5,],\n       title = \"Table. 1\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<caption style=\"font-weight: bold; text-align:left;\">Table. 1</caption>\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; text-align:left; \">Angaus</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">SegSumT</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">SegTSeas</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">SegLowFlow</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">DSDist</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">DSMaxSlope</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; col7\">USAvgT</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; col8\">USRainDays</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; col9\">USSlope</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; 0\">USNative</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; 1\">DSDam</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; 2\">Method</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; 3\">LocSed</th>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">0</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">16.00</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">-0.10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">1.04</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">50.20</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.57</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">0.09</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col8\">2.47</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col9\">9.80</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 0\">0.81</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 1\">0</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 2\">electric</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 3\">4.80</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">1</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">18.70</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">1.51</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">1.00</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">132.53</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">1.15</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">0.20</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col8\">1.15</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col9\">8.30</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 0\">0.34</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 1\">0</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 2\">electric</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 3\">2.00</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">0</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">18.30</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.37</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">1.00</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">107.44</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.57</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">0.49</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col8\">0.85</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col9\">0.40</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 0\">0.00</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 1\">0</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 2\">spo</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 3\">1.00</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">0</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">16.70</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">-3.80</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">1.00</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">166.82</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">1.72</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">0.90</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col8\">0.21</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col9\">0.40</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 0\">0.22</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 1\">1</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 2\">electric</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 3\">4.00</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; border-bottom: double; \">1</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">17.20</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">0.33</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">1.00</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">3.95</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">1.15</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; col7\">-1.20</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; col8\">1.98</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; col9\">21.90</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; 0\">0.96</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; 1\">0</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; 2\">electric</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; 3\">4.70</td>\n</tr>\n</table>\n\n`````\n:::\n:::\n\n\n### Split and Resample\n\nI split the data from above into a training and test set 70/30, stratified by outcome score. I used 10-fold CV to resample the training set, stratified by Angaus.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Stratified sampling with the rsample package\nset.seed(123) # Set a seed for reproducibility\nsplit <- initial_split(data = eel_data, \n                       prop = .7, \n                       strata = \"Angaus\")\n\neel_train <- training(split) # Grab training data\neel_test  <- testing(split) # Grab test data\n\n# Set up cross validation stratified on Angaus\ncv_folds <- eel_train %>% \n  vfold_cv(v=10, strata = \"Angaus\")\n```\n:::\n\n\n### Preprocess\n\nI created a recipe to prepare the data for the XGBoost model. I was interested in predicting the binary outcome variable Angaus which indicates presence or absence of the eel species *Anguilla australis*.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set up a recipe\neel_rec <- recipe(Angaus ~ ., data = eel_train) %>% \n  step_dummy(all_nominal(), -all_outcomes(), one_hot = TRUE) %>% \n  prep(training = eel_train, retain = TRUE)\n\n# Bake to check recipe\nbaked_eel <- bake(eel_rec, eel_train)\n```\n:::\n\n\n## Tuning XGBoost\n\n### Tune Learning Rate\n\nFirst I conducted tuning on just the learn_rate parameter.\n\n\n::: {.cell}\n\n```{.r .cell-code}\neel_spec <- parsnip::boost_tree(mode = \"classification\",\n                                engine = \"xgboost\",\n                                trees = 3000,\n                                learn_rate = tune())\n```\n:::\n\n\nI set up a grid to tune my model by using a range of learning rate parameter values.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set up tuning grid\neel_grid <- expand.grid(learn_rate = seq(0.0001, 0.3, length.out = 30))\n\n# Set up workflow\nwf_eel_tune <- workflow() %>% \n  add_recipe(eel_rec) %>% \n  add_model(eel_spec)\n\ndoParallel::registerDoParallel()\nset.seed(123)\n\n# Tune\neel_rs <- tune_grid(\n  wf_eel_tune,\n  Angaus~.,\n  resamples = cv_folds,\n  grid = eel_grid\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Identify best values from the tuning process\neel_rs %>%\n  tune::show_best(metric = \"accuracy\") %>%\n  tab_df(title = \"Table 2\",\n         digits = 4,\n         footnote = \"Performance of the best models and the associated estimates for the learning rate parameter values.\",\n         show.footnote = TRUE)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<caption style=\"font-weight: bold; text-align:left;\">Table 2</caption>\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; text-align:left; \">learn_rate</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">.metric</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">.estimator</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">mean</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">n</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">std_err</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; col7\">.config</th>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">0.1656</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">accuracy</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.8313</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.0103</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">Preprocessor1_Model17</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">0.1035</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">accuracy</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.8312</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.0092</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">Preprocessor1_Model11</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">0.3000</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">accuracy</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.8298</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.0129</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">Preprocessor1_Model30</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">0.1449</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">accuracy</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.8298</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.0110</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">Preprocessor1_Model15</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; border-bottom: double; \">0.2380</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">accuracy</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">0.8298</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">0.0111</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; col7\">Preprocessor1_Model24</td>\n</tr>\n<tr>\n<td colspan=\"8\" style=\"font-style:italic; border-top:double black; text-align:right;\">Performance of the best models and the associated estimates for the learning rate parameter values.</td>\n</tr>\n</table>\n\n`````\n:::\n\n```{.r .cell-code}\neel_best_learn <- eel_rs %>%\n  tune::select_best(\"accuracy\")\n\n# eel_model <- eel_spec %>% \n#   finalize_model(eel_best_learn)\n```\n:::\n\n\n### Tune Tree Parameters\n\nI created a new specification where I set the learning rate and tune the tree parameters.\n\n\n::: {.cell}\n\n```{.r .cell-code}\neel_spec2 <- parsnip::boost_tree(mode = \"classification\",\n                                engine = \"xgboost\",\n                                trees = 3000,\n                                learn_rate = eel_best_learn$learn_rate,\n                                min_n = tune(),\n                                tree_depth = tune(),\n                                loss_reduction = tune()\n                                )\n```\n:::\n\n\nI set up a tuning grid using grid_max_entropy() to get a representative sampling of the parameter space.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Define parameters to be tuned\neel_params <- dials::parameters(\n  min_n(),\n  tree_depth(),\n  loss_reduction()\n)\n\n# Set up grid\neel_grid2 <- dials::grid_max_entropy(eel_params, size = 30)\n\n# Set up workflow\nwf_eel_tune2 <- workflow() %>% \n  add_recipe(eel_rec) %>% \n  add_model(eel_spec2)\n\nset.seed(123)\ndoParallel::registerDoParallel()\n\n# Tune\neel_rs2 <- tune_grid(\n  wf_eel_tune2,\n  Angaus~.,\n  resamples = cv_folds,\n  grid = eel_grid2\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Identify best values from the tuning process\neel_rs2 %>%\n  tune::show_best(metric = \"accuracy\") %>%\n  tab_df(title = \"Table 3\",\n         digits = 4,\n         footnote = \"Performance of the best models and the associated estimates for the tree parameter values.\",\n         show.footnote = TRUE)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<caption style=\"font-weight: bold; text-align:left;\">Table 3</caption>\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; text-align:left; \">min_n</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">tree_depth</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">loss_reduction</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">.metric</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">.estimator</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">mean</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; col7\">n</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; col8\">std_err</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; col9\">.config</th>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">18</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">7</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.1440</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">accuracy</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.8413</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col8\">0.0102</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col9\">Preprocessor1_Model15</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">3</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">11</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.0000</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">accuracy</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.8385</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col8\">0.0135</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col9\">Preprocessor1_Model08</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">6</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">15</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.0000</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">accuracy</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.8342</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col8\">0.0136</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col9\">Preprocessor1_Model14</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">3</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">8</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.0000</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">accuracy</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.8342</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col8\">0.0128</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col9\">Preprocessor1_Model18</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; border-bottom: double; \">4</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">5</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">0.2273</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">accuracy</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">0.8314</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; col7\">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; col8\">0.0135</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; col9\">Preprocessor1_Model12</td>\n</tr>\n<tr>\n<td colspan=\"10\" style=\"font-style:italic; border-top:double black; text-align:right;\">Performance of the best models and the associated estimates for the tree parameter values.</td>\n</tr>\n</table>\n\n`````\n:::\n\n```{.r .cell-code}\neel_best_trees <- eel_rs2 %>%\n  tune::select_best(\"accuracy\")\n\n# eel_model2 <- eel_spec2 %>% \n#   finalize_model(eel_best_trees)\n```\n:::\n\n\n### Tune Stochastic Parameters\n\nI created another new specification where I set the learning rate and tree parameters and tune the stochastic parameters.\n\n\n::: {.cell}\n\n```{.r .cell-code}\neel_spec3 <- parsnip::boost_tree(mode = \"classification\",\n                                engine = \"xgboost\",\n                                trees = 3000,\n                                learn_rate = eel_best_learn$learn_rate,\n                                min_n = eel_best_trees$min_n,\n                                tree_depth = eel_best_trees$tree_depth,\n                                mtry = tune(),                   \n                                loss_reduction = eel_best_trees$loss_reduction,\n                                sample_size = tune(),\n                                stop_iter = tune()\n                                )\n```\n:::\n\n\nI set up a tuning grid using grid_max_entropy() again.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Define parameters to be tuned\neel_params2 <- dials::parameters(\n  finalize(mtry(),select(baked_eel,-Angaus)),\n  sample_size = sample_prop(c(.4, .9)),\n  stop_iter())\n\n# Set up grid\neel_grid3 <- dials::grid_max_entropy(eel_params2, size = 30)\n\n# Set up workflow\nwf_eel_tune3 <- workflow() %>% \n  add_recipe(eel_rec) %>% \n  add_model(eel_spec3)\n\nset.seed(123)\ndoParallel::registerDoParallel()\n\n# Tune\neel_rs3 <- tune_grid(\n  wf_eel_tune3,\n  Angaus~.,\n  resamples = cv_folds,\n  grid = eel_grid3\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Identify best values from the tuning process\neel_rs3 %>%\n  tune::show_best(metric = \"accuracy\") %>%\n  tab_df(title = \"Table 4\",\n         digits = 4,\n         footnote = \"Performance of the best models and the associated estimates for the stochastic parameter values.\",\n         show.footnote = TRUE)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<caption style=\"font-weight: bold; text-align:left;\">Table 4</caption>\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; text-align:left; \">mtry</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">sample_size</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">stop_iter</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">.metric</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">.estimator</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">mean</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; col7\">n</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; col8\">std_err</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; col9\">.config</th>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">14</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.7264</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">13</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">accuracy</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.8171</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col8\">0.0122</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col9\">Preprocessor1_Model20</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">9</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.7459</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">18</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">accuracy</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.8141</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col8\">0.0125</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col9\">Preprocessor1_Model26</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">16</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.8406</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">7</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">accuracy</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.8128</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col8\">0.0119</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col9\">Preprocessor1_Model17</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">6</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.7097</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">4</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">accuracy</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.8127</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col8\">0.0107</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col9\">Preprocessor1_Model09</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; border-bottom: double; \">5</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">0.8537</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">4</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">accuracy</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">0.8113</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; col7\">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; col8\">0.0102</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; col9\">Preprocessor1_Model22</td>\n</tr>\n<tr>\n<td colspan=\"10\" style=\"font-style:italic; border-top:double black; text-align:right;\">Performance of the best models and the associated estimates for the stochastic parameter values.</td>\n</tr>\n</table>\n\n`````\n:::\n\n```{.r .cell-code}\neel_best_stoch <- eel_rs3 %>%\n  tune::select_best(\"accuracy\")\n\neel_model3 <- eel_spec3 %>% \n  finalize_model(eel_best_stoch)\n```\n:::\n\n\n## Finalize workflow and make final prediction\n\nI assembled my final workflow with all of my optimized parameters and did a final fit.\n\n\n::: {.cell}\n\n```{.r .cell-code}\neel_final_spec <- parsnip::boost_tree(mode = \"classification\",\n                                engine = \"xgboost\",\n                                trees = 3000,\n                                learn_rate = eel_best_learn$learn_rate,\n                                min_n = eel_best_trees$min_n,\n                                tree_depth = eel_best_trees$tree_depth,\n                                mtry = eel_best_stoch$mtry,                   \n                                loss_reduction = eel_best_trees$loss_reduction,\n                                stop_iter = eel_best_stoch$stop_iter,\n                                sample_size = eel_best_stoch$sample_size\n                                )\n\n# Set up workflow\nwf_eel_final <- workflow() %>% \n  add_recipe(eel_rec) %>% \n  add_model(eel_final_spec)\n\nfinal_simple_fit <- wf_eel_final %>% # fit to just training data (need for later)\n  fit(data = eel_train)\n\nfinal_eel_fit <- last_fit(eel_final_spec, Angaus~., split) # does training fit then final prediction as well\n\n# Show predictions\nfinal_pred_tab <- as.data.frame(final_eel_fit$.predictions)\ntab_df(head(final_pred_tab),\n  title = \"Table 5\",\n  digits = 3,\n  footnote = \"Predictions of Angaus presence on test data.\",\n  show.footnote = TRUE)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<caption style=\"font-weight: bold; text-align:left;\">Table 5</caption>\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; text-align:left; \">.pred_0</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">.pred_1</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">.row</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">.pred_class</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">Angaus</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">.config</th>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; modelcolumn0 \">0.995</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.005</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">1</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">Preprocessor1_Model1</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; modelcolumn0 \">0.083</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.917</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">2</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">1</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">1</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">Preprocessor1_Model1</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; modelcolumn0 \">0.629</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.371</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">3</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">Preprocessor1_Model1</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; modelcolumn0 \">0.670</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.330</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">4</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">Preprocessor1_Model1</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; modelcolumn0 \">0.796</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.204</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">9</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">Preprocessor1_Model1</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; border-bottom: double; modelcolumn0 \">0.296</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double;  \">0.704</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">1</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">1</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">Preprocessor1_Model1</td>\n</tr>\n<tr>\n<td colspan=\"7\" style=\"font-style:italic; border-top:double black; text-align:right;\">Predictions of Angaus presence on test data.</td>\n</tr>\n</table>\n\n`````\n:::\n\n```{.r .cell-code}\nfinal_met_tab <- final_eel_fit$.metrics # Store metrics\ntab_df(final_met_tab,\n  title = \"Table 6\",\n  digits = 3,\n  footnote = \"Accuracy and area under ther receiver operator curve of the final fit.\",\n  show.footnote = TRUE)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<caption style=\"font-weight: bold; text-align:left;\">Table 6</caption>\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; text-align:left; \">.metric</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">.estimator</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">.estimate</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">.config</th>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">accuracy</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.843853820598007</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">Preprocessor1_Model1</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; border-bottom: double; \">roc_auc</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">0.866325136612022</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">Preprocessor1_Model1</td>\n</tr>\n<tr>\n<td colspan=\"5\" style=\"font-style:italic; border-top:double black; text-align:right;\">Accuracy and area under ther receiver operator curve of the final fit.</td>\n</tr>\n</table>\n\n`````\n:::\n\n```{.r .cell-code}\n# Bind predictions and original data\neel_test_rs <- cbind(eel_test, final_eel_fit$.predictions)\neel_test_rs <- eel_test_rs[,-1] # Remove duplicate column\n\n# Compute a confusion matrix\ncm<- eel_test_rs %>% yardstick::conf_mat(truth = Angaus, estimate = .pred_class) \n\nautoplot(cm, type = \"heatmap\") +\n  theme(axis.text.x = element_text(size = 12),\n        axis.text.y = element_text(size = 12),\n        axis.title = element_text(size = 14),\n        panel.background = element_rect(fill = \"#F8F8F8\"),\n        plot.background = element_rect(fill = \"#F8F8F8\")) +\n  labs(title = \"Figure 2: Confusion matrix of predictions on test data.\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n\n```{.r .cell-code}\ntibble <- final_eel_fit %>% collect_metrics()\n\nfinal_eel_accuracy <- tibble %>%\n  filter(.metric == \"accuracy\") %>%\n  pull(.estimate)\n\nfinal_eel_auc <- tibble %>%\n  filter(.metric == \"roc_auc\") %>%\n  pull(.estimate)\n```\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nThe model had an accuracy of 0.84. The ROC area under the curve was 0.87. The rate of false negatives was 0.11, and the rate of false positives was 0.05.\n```\n:::\n:::\n\n\n## Fit your model the evaluation data and compare performance\n\nI then fit my final model to the evaluation data set labeled \"eel.eval.data.csv.\"\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Read in eval data\neval_dat <- eval_dat_raw %>% \n  rename(Angaus = Angaus_obs) %>% # rename to match previous data\n  mutate(Angaus = as_factor(Angaus)) # make outcome a factor\n\nprediction <- final_simple_fit %>% predict(new_data = eval_dat) # generate predictions\neval_dat_pred <- cbind(eval_dat, prediction)\n\n# Compare predicted classes to actual classes\ncorrect_predictions <- sum(eval_dat_pred$.pred_class == eval_dat_pred$Angaus)\n\n# Calculate accuracy\naccuracy <- correct_predictions / nrow(eval_dat_pred)\n\n# Calculate auc\neval_dat_pred$pred_num <- as.numeric(eval_dat_pred$.pred_class)\nauc <- auc(eval_dat_pred$Angaus, eval_dat_pred$pred_num)\n```\n:::\n\n\nHow did my model perform on this data?\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nThe model had an accuracy of 0.81 on these data, which isn't quite as good as the accuracy when applying the model to the testing data. However the difference is not too extreme and seems pretty good given that the dummy classifier would be 0.744. The model had an AUC of 0.66 which does not seem great.\n```\n:::\n:::\n\n\nHow did my results compare to those of Elith et al.?\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nThe model here does not do as well as the model in Elith et al. which found a model AUC of 0.858. My AUC of 0.66is fairly far off. I would guess that Elith et al. did more tuning to find the optimal values, where as I was more limited by computing power.\n```\n:::\n:::\n\n\n## References\n\n\\[1\\] Elith, J., Leathwick, J.R. and Hastie, T. (2008), A working guide to boosted regression trees. Journal of Animal Ecology, 77: 802-813. https://doi.org/10.1111/j.1365-2656.2008.01390.x",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}